<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/img/test.png" sizes="512*512">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/basic.css">
    <script src="/js/jquery/jquery-3.6.0.min.js"></script>
    <title>SDGs 平等教育</title>
    <style>
        .control {
            width: 100%;
            background-color: #1A1A1A;
            height: 138px;
            border-radius: 5px;
            overflow: hidden;
        }

        .control_head {
            width: 100%;
            background-color: #6092ff;
            height: 10px;
        }

        .control_content {
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            height: 128px;
        }

        .form-check {
            transform: scale(1.5);
            margin-bottom: 10px;
        }

        .question {
            padding: 10px 40px 20px 40px;
            margin-top: 20px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            width: 100%;
            background-color: #1A1A1A;
        }

        .question_l {
            position: absolute;
            left: 0;
            top: 0;
            width: 10px;
            height: 100%;
            background-color: #6092ff;
            z-index: 10;
        }

        input[type=text] {
            color: #CCC !important;
            background-color: #1A1A1A !important;
            border-bottom: 2px solid #474aff !important;
        }

        .question_add {
            position: relative;
            margin-top: 20px;
            margin-right: 10px;
            white-space: nowrap;
            font-weight: bold;
        }

        .form-check {
            transform: none;
            display: flex;
            align-items: center;
        }

        .form-check .form-group {
            display: flex;
            align-items: center;
            flex-basis: 80%;
        }

        .form-check input[type=text] {
            color: #CCC !important;
            background-color: #1A1A1A !important;
            border-bottom: 2px solid #4772ff !important;
        }

        .anser_box {
            margin-top: 20px;
        }

        .qt {
            margin-top: 10px;
        }

        .btn-close {
            margin: 0 10px;
        }
    </style>
</head>

<body>
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark"">
        <div class=" container">
        <img src="/img/test.png" class="logo_top">
        <a href="#" class="navbar-brand">SDGs 平等教育</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/question">管理頁面</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/addquestion">新增題目</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/editquestion">修改題目</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/addpaper">新增問卷</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">修改問卷</a>
                </li>
            </ul>
            <ul class="navbar-nav ms-md-auto">
                <li class="nav-item">
                    <a target="_blank" rel="noopener" class="nav-link" href="#"><i class="fa fa-github"></i>修改密碼</a>
                </li>
                <li class="nav-item">
                    <a target="_blank" rel="noopener" class="nav-link" href="#"><i class="fa fa-github"></i>登出</a>
                </li>
            </ul>
        </div>
    </div>
    </div>
    <div id="container" class="container">
        <div class="control">
            <div class="control_head"></div>
            <div class="control_content">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="public">
                    <label class="form-check-label" for="public"> 公開</label>
                </div>
                <div class="btn-group" role="group" aria-label="Basic example">
                    <button type="button" class="btn btn-secondary" onclick="sw(1)">是非</button>
                    <button type="button" class="btn btn-secondary" onclick="sw(2)">單選</button>
                    <button type="button" class="btn btn-secondary" onclick="sw(3)">多選</button>
                    <button type="button" class="btn btn-secondary" onclick="sw(4)">填充</button>
                </div>
            </div>
        </div>
        <div class="question">
            <input type="hidden" id="type" value="1">
            <h4 class="qt">是非題</h4>
            <div class="question_l"></div>
            <div class="form-group">
                <label for="title" class="form-label mt-4">題目標題</label>
                <input type="text" class="form-control" maxlength="300" id="title" aria-describedby="emailHelp"
                    placeholder="標題名稱">
            </div>
            <div class="anser_box">
                <!-- 選擇 -->
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="radio" class="form-check-input" name="optionsRadios" id="optionsRadios1"
                            value="option1" checked>
                    </label>
                    <div class="form-group">是</div>
                </div>
                <!-- 選擇 -->
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="radio" class="form-check-input" name="optionsRadios" id="optionsRadios1"
                            value="option1" checked>
                    </label>
                    <div class="form-group">否</div>
                </div>
            </div>
            <button type="button" class="question_add btn btn-primary btn-sm">新增題目</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let Alert = msg => {
            let dom = $(`<div class="alert alert-dismissible alert-light"><button type="button" class="btn-close" data-bs-dismiss="alert"></button>${msg}</div>`);
            $('#container').append(dom);
            setTimeout(() => dom.remove(), 2000);
        };
        $('body').on('click', '.question_input_add', () => {
            let check = $('#cc').length ? 'checkbox' : 'radio'
            let input = `<div class="form-check"><label class="form-check-label">答案<input type="${check}"class="form-check-input"name="optionsRadios"id="optionsRadios1"value="option1"></label><div class="form-group"><input type="text"class="form-control"maxlength="300"aria-describedby="emailHelp"placeholder="選項內容"><button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button></div></div>`;
            $('.anser_box').append(input);
        })
        $('body').on('click', '.btn-close', event => {
            if ($('.form-check').length === 2) return;
            let self = event.target;
            $(self).parents('.form-check').remove();
        });
        function sw(code) {
            let html = [
                '',
                '<h4 class="qt">是非題</h4><input type="hidden" id="type" value="1"><div class="question_l"></div><div class="form-group"><label for="title"class="form-label mt-4">題目標題</label><input type="text"class="form-control"maxlength="300"id="title"aria-describedby="emailHelp"placeholder="標題名稱"></div><div class="anser_box"><!--選擇--><div class="form-check"><label class="form-check-label"><input type="radio"class="form-check-input"name="optionsRadios"id="optionsRadios1"value="option1"checked></label><div class="form-group">是</div></div><!--選擇--><div class="form-check"><label class="form-check-label"><input type="radio"class="form-check-input"name="optionsRadios"id="optionsRadios1"value="option1"checked></label><div class="form-group">否</div></div></div><button type="button"class="question_add btn btn-primary btn-sm">新增題目</button></div>',
                '<h4 class="qt">單選題</h4><input type="hidden" id="type" value="2"><div class="question_l"></div><div class="form-group"><label for="title"class="form-label mt-4">題目標題</label><input type="text"class="form-control"maxlength="300"id="title"aria-describedby="emailHelp"placeholder="標題名稱"></div><div class="anser_box"><!--選擇--><div class="form-check"><label class="form-check-label">答案<input type="radio"class="form-check-input"name="optionsRadios"id="optionsRadios1"value="option1"checked></label><div class="form-group"><input type="text"class="form-control"maxlength="300"aria-describedby="emailHelp"placeholder="選項內容"><button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button></div></div><!--選擇--><div class="form-check"><label class="form-check-label">答案<input type="radio"class="form-check-input"name="optionsRadios"id="optionsRadios1"value="option1"checked></label><div class="form-group"><input type="text"class="form-control"maxlength="300"aria-describedby="emailHelp"placeholder="選項內容"><button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button></div></div></div><button type="button"class="question_input_add question_add btn btn-primary btn-sm">新增選項</button><button type="button"class="question_add btn btn-primary btn-sm">新增題目</button>',
                '<h4 class="qt">多選題</h4><input type="hidden" id="cc"><input type="hidden" id="type" value="3"><div class="question_l"></div><div class="form-group"><label for="title"class="form-label mt-4">題目標題</label><input type="text"class="form-control"maxlength="300"id="title"aria-describedby="emailHelp"placeholder="標題名稱"></div><div class="anser_box"><!--選擇--><div class="form-check"><label class="form-check-label">答案<input type="checkbox"class="form-check-input"name="optionscheckboxs"id="optionscheckboxs1"value="option1"></label><div class="form-group"><input type="text"class="form-control"maxlength="300"aria-describedby="emailHelp"placeholder="選項內容"><button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button></div></div><!--選擇--><div class="form-check"><label class="form-check-label">答案<input type="checkbox"class="form-check-input"name="optionscheckboxs"id="optionscheckboxs1"value="option1"></label><div class="form-group"><input type="text"class="form-control"maxlength="300"aria-describedby="emailHelp"placeholder="選項內容"><button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button></div></div></div><button type="button"class="question_input_add question_add btn btn-primary btn-sm">新增選項</button><button type="button"class="question_add btn btn-primary btn-sm">新增題目</button>',
                '<h4 class="qt">填充題</h4><input type="hidden" id="type" value="4"><div class="question_l"></div><div class="form-group"><label for="title"class="form-label mt-4">題目標題</label><input type="text"class="form-control"maxlength="300"id="title"aria-describedby="emailHelp"placeholder="標題名稱"></div><button type="button"class="question_add btn btn-primary btn-sm">新增題目</button>'
            ];
            $('.question').html(html[code]);
        }
        $('body').on('click', '.question_add:not(.question_input_add)', event => {
            let error = false;
            let input = []
            if ($('#title').val() === '') error = true;
            $('input:not(#title):text:visible').each((i, e) => {
                if (error) return;
                if (e.value === '') {
                    error = true;
                    return;
                }
                input.push({
                    text: e.value,
                    isAnser: false
                });
            })
            let type = $('#type').val();
            if (type != 4 && $('.question input:checked').length == 0)
                error = true;
            if (error) {
                Alert('資料填寫不完整');
                return;
            }
            let isAnser = false;
            if (type == 1)
                isAnser = $('input:radio').index($('input:radio:checked')) == 0 ? true : false;
            else if (type == 2)
                input[$('input:radio').index($('input:radio:checked'))].isAnser = true;
            else if (type == 3) {
                $('.question input:checkbox').each((i, e) => {
                    if ($(e).is(':checked'))
                        input[i].isAnser = true;
                })
            }
            let send = {
                type: $('#type').val(),
                public: $('#public').is(':checked'),
                name: $('#title').val(),
                input: input,
                isAnser: isAnser
            }
            $.post('/insertQuestion', send).done(json => {
                if (json.status == 200) {
                    Alert(json.msg);
                }
            }).fail(json => {
                console.log(json);
                Alert('未知錯誤');
            })
        });
    </script>
</body>

</html>